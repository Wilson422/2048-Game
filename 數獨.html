<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>é€²éšç‰ˆæ•¸ç¨ (å®Œç¾é«”é©—ç‰ˆ)</title>
<style>
  :root {
    --bg-app: #f3f4f6;
    --bg-card: #ffffff;
    --primary: #2563eb;
    --primary-light: #eff6ff;
    --text-main: #1f2937;
    --text-sub: #6b7280;
    --border: #e5e7eb;
    --grid-line: #d1d5db;
    --grid-bold: #6b7280;
    --cell-bg: #ffffff;
    --cell-alt: #f8fafc; /* 3x3å€å¡Šäº¤éŒ¯è‰² */
    --cell-fixed: #111827;
    --cell-input: #1d4ed8;
    --cell-note: #64748b;
    --success: #16a34a;
    --error: #ef4444;
    --radius: 12px;
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: var(--bg-app);
    color: var(--text-main);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* --- App å®¹å™¨ --- */
  .app-container {
    width: 100%;
    max-width: 1000px;
    padding: 20px;
    display: grid;
    grid-template-columns: 1fr 340px; /* PC: å·¦æ£‹ç›¤ å³æ§åˆ¶ */
    gap: 24px;
    align-items: start;
  }

  /* --- Header --- */
  header {
    grid-column: 1 / -1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--bg-card);
    padding: 12px 20px;
    border-radius: var(--radius);
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    border: 1px solid var(--border);
  }

  h1 {
    font-size: 1.25rem;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .badge {
    font-size: 0.7rem;
    background: var(--primary-light);
    color: var(--primary);
    padding: 2px 8px;
    border-radius: 99px;
    border: 1px solid #dbeafe;
  }

  /* --- æ£‹ç›¤å€åŸŸ --- */
  .board-section {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .status-bar {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    color: var(--text-sub);
    background: var(--bg-card);
    padding: 8px 16px;
    border-radius: 99px;
    border: 1px solid var(--border);
    box-shadow: 0 1px 2px rgba(0,0,0,0.03);
  }

  .status-item { display: flex; align-items: center; gap: 6px; }

  #sudoku-board {
    width: 100%;
    max-width: 550px;
    aspect-ratio: 1 / 1;
    margin: 0 auto;
    background: var(--bg-card);
    border: 2px solid var(--grid-bold);
    display: grid;
    grid-template-columns: repeat(9, 1fr);
    grid-template-rows: repeat(9, 1fr);
    border-radius: 4px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    position: relative;
  }

  /* --- æ ¼å­æ¨£å¼ (æ ¸å¿ƒä¿®æ­£) --- */
  .cell {
    border: 1px solid var(--grid-line);
    display: flex;
    align-items: center;     /* å‚ç›´ç½®ä¸­ */
    justify-content: center; /* æ°´å¹³ç½®ä¸­ */
    font-size: clamp(20px, 4vw, 32px); /* å¤§å­—é«” */
    cursor: pointer;
    user-select: none;
    position: relative;
    background: var(--cell-bg);
    transition: background 0.1s;
    color: var(--cell-input);
    font-weight: 500;
  }

  /* é¡Œç›®å›ºå®šæ•¸å­— */
  .cell.fixed {
    font-weight: 700;
    color: var(--cell-fixed);
  }

  /* è‰ç¨¿æ¨¡å¼å°ˆç”¨æ¨£å¼ (è¦†è“‹é è¨­æ¨£å¼) */
  .cell.is-note {
    align-items: flex-start;     /* é ä¸Š */
    justify-content: flex-start; /* é å·¦ */
    padding: 2px;
    flex-wrap: wrap;
    font-size: 10px !important;  /* å¼·åˆ¶å°å­— */
    line-height: 1.1;
    color: var(--cell-note);
    letter-spacing: 1px;
    font-weight: normal;
  }

  /* 3x3 å€å¡Šç·šæ¢ */
  .cell:nth-child(3n) { border-right: 2px solid var(--grid-bold); }
  .cell:nth-child(9n) { border-right: none; } 
  .cell:nth-child(n+19):nth-child(-n+27),
  .cell:nth-child(n+46):nth-child(-n+54) {
    border-bottom: 2px solid var(--grid-bold);
  }

  /* å€å¡Šäº¤éŒ¯åº•è‰² */
  .cell.block-alt { background-color: var(--cell-alt); }

  /* äº’å‹•ç‹€æ…‹ */
  .cell.selected { background-color: #bfdbfe !important; }
  .cell.highlight { background-color: #eff6ff; } /* åŒè¡Œåˆ— */
  .cell.same-number { background-color: #dbeafe; font-weight: 700; }
  .cell.conflict { background-color: #fee2e2 !important; color: var(--error); }
  .cell.correct-anim { animation: pop 0.3s ease-out; }

  /* --- æ§åˆ¶é¢æ¿ (å³å´) --- */
  .controls-section {
    background: var(--bg-card);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  /* é›£åº¦é¸æ“‡ */
  .difficulty-selector {
    display: flex;
    background: var(--bg-app);
    padding: 4px;
    border-radius: 8px;
  }

  .diff-btn {
    flex: 1;
    border: none;
    background: transparent;
    padding: 8px;
    font-size: 0.9rem;
    color: var(--text-sub);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .diff-btn.active {
    background: #ffffff;
    color: var(--primary);
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    font-weight: 600;
  }

  /* å·¥å…·åˆ— */
  .tools-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }
  .tool-btn {
    padding: 10px;
    border: 1px solid var(--border);
    background: #fff;
    border-radius: 8px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    cursor: pointer;
  }
  .tool-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  /* æ•¸å­—éµç›¤ */
  .numpad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
  }
  .num-btn {
    aspect-ratio: 1.5 / 1;
    border: 1px solid var(--border);
    background: #ffffff;
    border-radius: 8px;
    font-size: 1.25rem;
    color: var(--primary);
    cursor: pointer;
    transition: transform 0.05s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .num-btn:active { transform: scale(0.96); background: var(--primary-light); }

  .action-btn {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    background: var(--primary);
    color: white;
    margin-top: auto;
  }

  .hint-text {
    font-size: 0.8rem;
    color: var(--text-sub);
    text-align: center;
    margin-top: 8px;
    min-height: 1.2em;
  }

  /* --- RWD æ‰‹æ©Ÿç‰ˆ (å¯¬åº¦ < 850px) --- */
  @media (max-width: 850px) {
    .app-container {
      grid-template-columns: 1fr;
      grid-template-rows: auto auto 1fr;
      padding: 10px;
      gap: 10px;
    }
    header { padding: 8px 12px; }
    h1 { font-size: 1.1rem; }
    .badge { display: none; }
    
    .status-bar {
      justify-content: space-around;
      background: transparent; border: none; box-shadow: none; padding: 0;
    }

    .controls-section {
      padding: 0; border: none; background: transparent; gap: 10px;
    }
    
    /* æ‰‹æ©Ÿç‰ˆéµç›¤ä½ˆå±€å„ªåŒ– */
    .numpad {
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
    }
    .num-btn {
      font-size: 1.2rem;
      aspect-ratio: 1 / 1;
      border-radius: 50%; /* åœ“å½¢æŒ‰éˆ• */
      border: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #btn-num-0 { color: var(--error); }
    
    .tools-grid { grid-template-columns: repeat(4, 1fr); }
    .tool-btn { flex-direction: column; font-size: 0.75rem; padding: 6px; }
    
    .shortcuts { display: none; }
  }

  @keyframes pop { 50% { transform: scale(1.2); } }
</style>
</head>
<body>

<div class="app-container">
  
  <!-- Header -->
  <header>
    <h1>æ•¸ç¨ Sudoku <span class="badge">Unique Solution</span></h1>
    <div class="difficulty-selector">
      <button class="diff-btn active" onclick="setDifficulty('easy')">ç°¡å–®</button>
      <button class="diff-btn" onclick="setDifficulty('medium')">æ™®é€š</button>
      <button class="diff-btn" onclick="setDifficulty('hard')">å›°é›£</button>
    </div>
  </header>

  <!-- æ£‹ç›¤å€ -->
  <div class="board-section">
    <div class="status-bar">
      <div class="status-item">â³ <span id="timer">00:00</span></div>
      <div class="status-item">âŒ <span id="mistakes">0</span>/3</div>
    </div>
    <div id="sudoku-board"></div>
    <div class="hint-text" id="status-msg">è«‹é¸æ“‡é›£åº¦ä¸¦é–‹å§‹éŠæˆ²</div>
  </div>

  <!-- æ§åˆ¶å€ -->
  <div class="controls-section">
    <!-- å·¥å…·åˆ— -->
    <div class="tools-grid">
      <button class="tool-btn" id="btn-note" onclick="toggleNoteMode()">
        âœï¸ <span>è‰ç¨¿</span>
      </button>
      <button class="tool-btn" onclick="giveHint()">
        ğŸ’¡ <span>æç¤º</span>
      </button>
      <button class="tool-btn" onclick="checkBoard()">
        âœ… <span>æª¢æŸ¥</span>
      </button>
      <button class="tool-btn" onclick="resetBoard()">
        ğŸ” <span>é‡ç½®</span>
      </button>
    </div>

    <!-- æ•¸å­—éµç›¤ -->
    <div class="numpad" id="numpad"></div>

    <button class="action-btn" onclick="newGame()">æ–°çš„ä¸€å±€</button>
    
    <div class="shortcuts" style="margin-top: 12px; font-size: 0.8rem; color: #9ca3af; text-align: center;">
      ğŸ’» éµç›¤ï¼šæ–¹å‘éµç§»å‹•ã€æ•¸å­—éµå¡«å…¥ã€N åˆ‡æ›è‰ç¨¿
    </div>
  </div>
</div>

<script>
// --- æ ¸å¿ƒè®Šæ•¸ ---
let board = []; // å­˜æ”¾ 1-9 æˆ– 0
let notes = []; // å­˜æ”¾è‰ç¨¿å­—ä¸²ï¼Œä¾‹å¦‚ "1,3,5"
let solution = []; 
let initialBoard = [];
let timerInterval;
let seconds = 0;
let mistakes = 0;
let isNoteMode = false;
let selectedCellIndex = -1;
let currentDifficulty = 'easy';

window.onload = () => {
  initUI();
  newGame();
};

function initUI() {
  const boardEl = document.getElementById('sudoku-board');
  boardEl.innerHTML = '';
  
  for (let i = 0; i < 81; i++) {
    const cell = document.createElement('div');
    cell.classList.add('cell');
    
    // 3x3 å€å¡Šäº¤éŒ¯èƒŒæ™¯
    const row = Math.floor(i / 9);
    const col = i % 9;
    const blockRow = Math.floor(row / 3);
    const blockCol = Math.floor(col / 3);
    if ((blockRow * 3 + blockCol) % 2 !== 0) {
      cell.classList.add('block-alt');
    }

    cell.dataset.index = i;
    cell.onclick = () => selectCell(i);
    boardEl.appendChild(cell);
  }

  // æ•¸å­—éµç›¤
  const numpad = document.getElementById('numpad');
  numpad.innerHTML = '';
  for (let n = 1; n <= 9; n++) {
    const btn = document.createElement('button');
    btn.className = 'num-btn';
    btn.textContent = n;
    btn.onclick = () => inputNumber(n);
    numpad.appendChild(btn);
  }
  const clearBtn = document.createElement('button');
  clearBtn.className = 'num-btn';
  clearBtn.id = 'btn-num-0';
  clearBtn.textContent = 'âŒ«';
  clearBtn.onclick = () => inputNumber(0);
  numpad.appendChild(clearBtn);

  document.addEventListener('keydown', handleKeyboard);
}

function newGame() {
  clearInterval(timerInterval);
  seconds = 0;
  mistakes = 0;
  document.getElementById('timer').textContent = "00:00";
  document.getElementById('mistakes').textContent = "0";
  updateStatus("æ­£åœ¨ç”Ÿæˆé¡Œç›®...");

  setTimeout(() => {
    const fullBoard = generateFullSolution();
    solution = [...fullBoard];
    
    const holes = currentDifficulty === 'easy' ? 30 : (currentDifficulty === 'medium' ? 40 : 50);
    initialBoard = removeNumbers(fullBoard, holes);
    board = [...initialBoard];
    notes = Array(81).fill(''); // é‡ç½®è‰ç¨¿

    renderBoard();
    startTimer();
    updateStatus("éŠæˆ²é–‹å§‹ï¼");
  }, 50);
}

function setDifficulty(diff) {
  currentDifficulty = diff;
  document.querySelectorAll('.diff-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  newGame();
}

// --- æ¸²æŸ“é‚è¼¯ ---
function renderBoard() {
  const cells = document.querySelectorAll('.cell');
  cells.forEach((cell, i) => {
    // æ¸…é™¤æ‰€æœ‰ç‹€æ…‹ class
    cell.classList.remove('fixed', 'selected', 'highlight', 'same-number', 'conflict', 'correct-anim', 'is-note');
    cell.textContent = '';
    cell.style.color = ''; // é‡ç½®é¡è‰²

    const val = board[i];
    const initialVal = initialBoard[i];
    const noteVal = notes[i];

    if (initialVal !== 0) {
      // é¡Œç›®å›ºå®šæ•¸å­—
      cell.classList.add('fixed');
      cell.textContent = initialVal;
    } else if (val !== 0) {
      // ç©å®¶å¡«å…¥çš„æ•¸å­—
      cell.textContent = val;
      // å¦‚æœå¡«éŒ¯äº†æ¨™è¨˜ç´…è‰²
      if (val !== solution[i]) {
        cell.classList.add('conflict');
      } else {
        cell.style.color = 'var(--cell-input)';
      }
    } else if (noteVal !== '') {
      // è‰ç¨¿ç‹€æ…‹
      cell.classList.add('is-note'); // åŠ å…¥è‰ç¨¿å°ˆç”¨ class (è®Šå°å­—)
      cell.textContent = noteVal.split(',').join(' ');
    }
  });
  
  // ä¿æŒé¸ä¸­ç‹€æ…‹
  if (selectedCellIndex !== -1) selectCell(selectedCellIndex);
}

function selectCell(index) {
  selectedCellIndex = index;
  const cells = document.querySelectorAll('.cell');
  const selectedVal = board[index]; // åªå–æ­£å¼å¡«å…¥çš„æ•¸å­—ï¼Œä¸å–è‰ç¨¿

  cells.forEach((cell, i) => {
    cell.classList.remove('selected', 'highlight', 'same-number');
    
    if (i === index) cell.classList.add('selected');

    const r1 = Math.floor(index / 9);
    const c1 = index % 9;
    const r2 = Math.floor(i / 9);
    const c2 = i % 9;

    if (r1 === r2 || c1 === c2) {
      cell.classList.add('highlight');
    }

    // åªæœ‰ç•¶å‰æ ¼æœ‰æ­£å¼æ•¸å­—æ™‚ï¼Œæ‰é«˜äº®å…¶ä»–ç›¸åŒæ•¸å­—
    if (selectedVal !== 0 && board[i] === selectedVal) {
      cell.classList.add('same-number');
    }
  });
}

function inputNumber(num) {
  if (selectedCellIndex === -1) return;
  if (initialBoard[selectedCellIndex] !== 0) return; // å›ºå®šæ ¼ä¸å¯æ”¹

  const cell = document.querySelectorAll('.cell')[selectedCellIndex];

  // æ¸…é™¤åŠŸèƒ½
  if (num === 0) {
    board[selectedCellIndex] = 0;
    notes[selectedCellIndex] = '';
    renderBoard();
    return;
  }

  // è‰ç¨¿æ¨¡å¼
  if (isNoteMode) {
    // å¦‚æœå·²ç¶“å¡«äº†æ­£å¼æ•¸å­—ï¼Œå…ˆæ¸…æ‰
    if (board[selectedCellIndex] !== 0) {
      board[selectedCellIndex] = 0;
    }
    
    let currentNotes = notes[selectedCellIndex] ? notes[selectedCellIndex].split(',') : [];
    const sNum = num.toString();
    
    if (currentNotes.includes(sNum)) {
      currentNotes = currentNotes.filter(n => n !== sNum); // å–æ¶ˆ
    } else {
      currentNotes.push(sNum); // åŠ å…¥
    }
    currentNotes.sort();
    notes[selectedCellIndex] = currentNotes.join(',');
    
    renderBoard();
    return;
  }

  // ä¸€èˆ¬å¡«å¯«æ¨¡å¼
  // æ¸…é™¤è©²æ ¼çš„è‰ç¨¿
  notes[selectedCellIndex] = '';
  
  if (num !== solution[selectedCellIndex]) {
    mistakes++;
    document.getElementById('mistakes').textContent = mistakes;
    board[selectedCellIndex] = num; // å³ä½¿éŒ¯äº†ä¹Ÿå…ˆå¡«å…¥ï¼Œè®“ renderBoard æ¨™ç´…
    renderBoard();
    updateStatus("æ•¸å­—ä¸å°å–”ï¼");
    if (mistakes >= 3) updateStatus("éŒ¯èª¤é” 3 æ¬¡ï¼Œå»ºè­°ä½¿ç”¨æç¤ºï¼");
  } else {
    // æ­£ç¢º
    board[selectedCellIndex] = num;
    renderBoard();
    const targetCell = document.querySelectorAll('.cell')[selectedCellIndex];
    targetCell.classList.add('correct-anim');
    
    if (!board.includes(0)) {
      clearInterval(timerInterval);
      updateStatus("ğŸ‰ æ­å–œé€šé—œï¼");
      setTimeout(() => alert("æ­å–œï¼ç”¨æ™‚ï¼š" + document.getElementById('timer').textContent), 100);
    }
  }
}

function toggleNoteMode() {
  isNoteMode = !isNoteMode;
  const btn = document.getElementById('btn-note');
  if (isNoteMode) {
    btn.classList.add('active');
    updateStatus("è‰ç¨¿æ¨¡å¼ ON");
  } else {
    btn.classList.remove('active');
    updateStatus("è‰ç¨¿æ¨¡å¼ OFF");
  }
}

function giveHint() {
  // æ‰¾ä¸€å€‹é‚„æ²’å¡«å°çš„æ ¼å­
  const available = [];
  board.forEach((val, i) => {
    if (val === 0 || val !== solution[i]) {
      available.push(i);
    }
  });
  
  if (available.length === 0) return;

  // å¦‚æœæœ‰é¸ä¸­ç©ºæ ¼ï¼Œå°±å¡«é¸ä¸­çš„ï¼Œå¦å‰‡éš¨æ©Ÿ
  let targetIdx = selectedCellIndex;
  if (targetIdx === -1 || board[targetIdx] === solution[targetIdx]) {
    targetIdx = available[Math.floor(Math.random() * available.length)];
  }

  board[targetIdx] = solution[targetIdx];
  notes[targetIdx] = ''; // æ¸…é™¤è‰ç¨¿
  
  renderBoard();
  selectCell(targetIdx);
  updateStatus("å·²å¡«å…¥æç¤º");
}

function checkBoard() {
  let errCount = 0;
  board.forEach((v, i) => {
    if (v !== 0 && v !== solution[i]) {
      errCount++;
    }
  });
  renderBoard(); // é‡æ–°æ¸²æŸ“æœƒè‡ªå‹•æŠŠéŒ¯çš„æ¨™ç´…
  updateStatus(errCount > 0 ? `ç™¼ç¾ ${errCount} å€‹éŒ¯èª¤` : "ç›®å‰å…¨å°ï¼");
}

function resetBoard() {
  if(!confirm("é‡ç½®æœ¬å±€ï¼Ÿ")) return;
  board = [...initialBoard];
  notes = Array(81).fill('');
  mistakes = 0;
  document.getElementById('mistakes').textContent = 0;
  renderBoard();
}

// --- æ•¸ç¨ç”Ÿæˆæ¼”ç®—æ³• ---
function generateFullSolution() {
  const b = Array(81).fill(0);
  fillBoard(b);
  return b;
}

function fillBoard(b) {
  const empty = b.indexOf(0);
  if (empty === -1) return true;
  const nums = shuffle([1,2,3,4,5,6,7,8,9]);
  for (let n of nums) {
    if (isValid(b, empty, n)) {
      b[empty] = n;
      if (fillBoard(b)) return true;
      b[empty] = 0;
    }
  }
  return false;
}

function removeNumbers(solvedBoard, attempts) {
  let b = [...solvedBoard];
  let count = attempts;
  while (count > 0) {
    let idx = Math.floor(Math.random() * 81);
    if (b[idx] !== 0) {
      let backup = b[idx];
      b[idx] = 0;
      // ç°¡å–®é©—è­‰å”¯ä¸€è§£ (è¨ˆç®—è§£æ•¸é‡ï¼Œè¶…é1å€‹å°±é‚„åŸ)
      let solutions = 0;
      solveCount(b, (c) => solutions = c);
      if (solutions !== 1) b[idx] = backup;
      else count--;
    }
  }
  return b;
}

function solveCount(b, cb, ref={c:0}) {
  const empty = b.indexOf(0);
  if (empty === -1) { ref.c++; return; }
  for (let n=1; n<=9; n++) {
    if (ref.c > 1) return; 
    if (isValid(b, empty, n)) {
      b[empty] = n;
      solveCount(b, cb, ref);
      b[empty] = 0;
    }
  }
  cb(ref.c);
}

function isValid(b, idx, n) {
  const r = Math.floor(idx/9);
  const c = idx%9;
  const br = Math.floor(r/3)*3;
  const bc = Math.floor(c/3)*3;
  for (let i=0; i<9; i++) {
    if (b[r*9+i]===n) return false;
    if (b[i*9+c]===n) return false;
    const bi = (br+Math.floor(i/3))*9 + (bc+i%3);
    if (b[bi]===n) return false;
  }
  return true;
}

function shuffle(arr) { return arr.sort(()=>Math.random()-0.5); }

// --- è¼”åŠ© ---
function startTimer() {
  timerInterval = setInterval(() => {
    seconds++;
    const m = Math.floor(seconds / 60).toString().padStart(2, '0');
    const s = (seconds % 60).toString().padStart(2, '0');
    document.getElementById('timer').textContent = `${m}:${s}`;
  }, 1000);
}

function updateStatus(msg) {
  const el = document.getElementById('status-msg');
  el.textContent = msg;
  el.style.opacity = 1;
  setTimeout(() => { el.style.opacity = 0.7; }, 3000);
}

function handleKeyboard(e) {
  if (selectedCellIndex === -1) return;
  const k = e.key;
  if (k >= '1' && k <= '9') inputNumber(parseInt(k));
  if (k === '0' || k === 'Backspace' || k === 'Delete') inputNumber(0);
  if (k.toLowerCase() === 'n') toggleNoteMode();
  
  if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(k)) {
    e.preventDefault();
    let r = Math.floor(selectedCellIndex / 9);
    let c = selectedCellIndex % 9;
    if (k === 'ArrowUp') r = (r - 1 + 9) % 9;
    if (k === 'ArrowDown') r = (r + 1) % 9;
    if (k === 'ArrowLeft') c = (c - 1 + 9) % 9;
    if (k === 'ArrowRight') c = (c + 1) % 9;
    selectCell(r * 9 + c);
  }
}
</script>
</body>
</html>
